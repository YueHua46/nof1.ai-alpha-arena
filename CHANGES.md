# 系统更新说明

## 📅 更新时间：2025-11-24

## ✨ 主要更新

### 1. 💰 Dashboard 界面优化 - 清晰显示盈亏状况

#### 新增的指标卡片（5个）：

1. **总权益 (Total Equity)** 
   - 显示：可用余额 + 持仓价值
   - 这是您的账户总价值

2. **可用资金 (Available)**
   - 显示：可用于交易的 USDT
   - 这是您可以用来开新仓位的金额

3. **盈亏 (P&L)**
   - 显示：当前总权益 - 初始投入金额
   - 绿色表示盈利，红色表示亏损
   - 例如：初始 $200，现在 $250 → 显示 **+$50.00** (绿色)

4. **收益率 (Return)**
   - 显示：盈亏百分比
   - 绿色表示正收益，红色表示负收益
   - 例如：+25.00% 或 -5.00%

5. **持仓数 (Positions)**
   - 显示：当前持有的仓位数量

#### 实时更新
- 每 3 秒自动更新一次
- 所有数据都是实时的
- 盈亏颜色会根据正负自动变化

---

### 2. 🎯 风险管理配置优化

#### 新增配置项（.env 文件）：

```bash
# 风险管理配置
# 单次交易最大占账户权益的比例 (0.3 = 30%)
POSITION_RISK_FRACTION=0.3

# 初始投入金额 (USDT)
INITIAL_CAPITAL=200
```

#### 配置说明：

**POSITION_RISK_FRACTION=0.3**
- 含义：单次交易最多使用账户总权益的 30%
- 之前：10%（过于保守）
- 现在：30%（更激进，但风险更高）
- 例如：总权益 $200，单次最多使用 $60

**INITIAL_CAPITAL=200**
- 含义：您的初始投入金额
- 用于计算盈亏：当前总权益 - 初始投入 = 盈亏金额
- 用于计算收益率：(当前总权益 - 初始投入) / 初始投入 × 100%

---

### 3. 📊 下单流程增强 - 完整透明

#### 每次下单前会显示：

```
============================================================
🎯 开始处理 BTC 的 BUY 决策
💼 资金分配计算：
   账户总权益: $200.00 USDT
   风险比例: 30.0%
   最大可用资金: $60.00 USDT
   LLM 建议资金: $80.00 USDT
   ⚠️  LLM 建议资金超过上限，已调整为最大可用资金
   ✅ 最终分配: $60.00 USDT
============================================================
```

#### 每次下单时会显示：

```
💰 当前账户余额 - 可用: $195.50 USDT | 总权益: $200.00 USDT
📊 BTC 当前价格: $95,000.00
📝 准备下 BUY 单：
   标的: BTC/USDT:USDT
   数量: 0.000632 BTC
   💵 价值: $60.00 USDT
   合约: 0.0632 张
   合约面值: 0.01 BTC/张
⚠️  警告：下单价值 $60.00 超过可用余额 $50.00，交易所可能拒绝订单
🚀 正在提交订单...
✅ 订单提交成功！订单ID: 123456789
```

---

## 🎯 如何追踪盈亏

### 方法 1：Dashboard 界面（推荐）

打开浏览器访问：`http://localhost:3000`

查看顶部的 5 个指标卡片：
- **总权益**：了解当前总价值
- **可用资金**：了解还能用多少资金开仓
- **盈亏**：一目了然看到赚了或亏了多少钱
- **收益率**：看到盈亏的百分比

### 方法 2：日志文件

查看文件：`bot.log`

关键日志：
```
💰 账户初始权益：$200.00 USDT (配置的初始投入：$200.00)
💰 当前账户余额 - 可用: $195.50 USDT | 总权益: $210.00 USDT
```

计算：$210.00 - $200.00 = **+$10.00** (盈利)

---

## ⚙️ 配置文件位置

- 主配置文件：`.env`
- 修改后需要重启程序才能生效

---

## 🚀 启动方式

```bash
# 启动 GUI 界面
python main.py

# 然后在浏览器打开
http://localhost:3000
```

---

## 📝 注意事项

1. **风险提示**：30% 的单次交易比例意味着更高的风险和潜在收益
2. **余额检查**：每次下单都会检查余额是否充足
3. **实时更新**：Dashboard 每 3 秒自动刷新
4. **初始投入**：确保 `INITIAL_CAPITAL` 设置正确，这会影响盈亏计算

---

## 🐛 问题排查

### 问题：Dashboard 不显示盈亏

**解决方案**：
1. 检查 `.env` 文件中是否设置了 `INITIAL_CAPITAL=200`
2. 重启程序
3. 刷新浏览器页面

### 问题：下单比例不是 30%

**解决方案**：
1. 检查 `.env` 文件中是否设置了 `POSITION_RISK_FRACTION=0.3`
2. 重启程序
3. 查看日志确认：`💼 风险管理配置：单次交易最大占比 30.0%`

---

## 📞 技术支持

如有问题，请查看：
- 日志文件：`bot.log`
- 提示日志：`data/prompts.log`
- 交易日志：`data/diary.jsonl`

